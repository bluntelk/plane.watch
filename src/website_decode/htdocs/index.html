<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Mode S Packet Decoder</title>
    <link rel="stylesheet" href="css/foundation.css">
    <link rel="stylesheet" href="css/app.css">
</head>
<body>

<div class="callout large primary">
    <div class="row column text-center">
        <h1>Mode S Packet Decoder</h1>
        <h2 class="subheader">Decoding your Mode S (and ADS-B) packets</h2>
    </div>
</div>

<div class="row">
    <div class="column small-4">
        <p class="float-right">Example Packets</p>
    </div>
    <div class="column small-8">
        <div id="examples"></div>
    </div>
</div>
<div class="row medium-12 columns">
    <div class="column small-4">
    </div>
    <div class="column small-8">
        <form action="#" method="POST" id="input-form">
            <div class="input-group">
                <input class="input-group-field" name="packet" title="packet" type="text" id="packet"/>
                <div class="input-group-button">
                    <input class="button" type="submit" value="Decode Packet!">
                </div>
            </div>
        </form>
    </div>
</div>

<div class="row medium-12 large-12 columns">
    <pre id="result">

    </pre>
</div>

<script type="application/javascript" src="js/vendor/jquery.js"></script>

<script>
    $(document).ready(function () {
        $('#packet').val("*A028009F96887B05FFA000413602;");
        $('#input-form').submit(function (event) {
            var packet = $('#packet').val();
            $.get("/decode", {'packet': packet})
                    .done(function (data) {
                        $('#result').html(data)
                    })
                    .fail(function () {
                        $('#result').html("Failed to get data")
                    });
            event.preventDefault();
        });
    });
    var examplePackets = {
        21: ['*A8000B3A001CA9138000001C4E2F;', '*A828080800000030E40005E3A949;', '*A8280808FF5F8B0A8004329463A3;', '*A8001F1B00000030CC000057C402;', '*A8001F1B0010BB1B40046FE67663;', '*A8000A1A80509D118004452EE5BE;', '*A8000A00000000000000050008E3;', '*A8000A0000000000000432C6CFAF;', '*A8000D088BBC5DF0D001041D8E1F;', '*A8000D08F19ED317FDF46C1B4FFC;'],
        5: ['*29001B3AF47E76;', '*28001B1F2181F6;', '*28000D08CEE4C5;', '*2820050BD0D698;', '*2800050B95AAB1;', '*28000300448966;', '*28000E980FDA8E;', '*29001E0D3CB4BF;', '*280011814A6674;', '*29000A1AEE1F58;'],
        17: ['*8D7C1BE8581B66E9BD8CEEDC1C9F;', '*8D7C7181991060866808026F519B;', '*8C7C1474381DA443C6450A369656;', '*8D7C431FBF59D00000000069B618;', '*8D7C7181F80000060049A8F9E70F;', '*8D7C7181E1050B00000000C13340;', '*8D7C7181215D01A08208204D8BF1;', '*8DA8BBE7EA0BD870013F082BC5C5;', '*8C7C451C423C52D692D953855472;', '*8D76E72A6837D373A0DB1871D882;'],
        0: ['*00050319AB8C22;', '*02818314F34FE7;', '*02410097A181E3;', '*000001B6747458;', '*028183150CBBEE;', '*02619420C9D617;', '*0000011D8D208A;', '*00C586A2FD84DD;', '*0000019075E0F5;', '*02818335D9DA51;'],
        11: ['*5F7C7B5ABB4F87;', '*5DA8BBE71A5F07;', '*5D7C0B6DB05076;', '*5D7C431FBE0A77;', '*5D7C7534BAE2B0;', '*5D7C1B28ACC729;', '*5D7C431FBE0A73;', '*5D7C7A5D1D6885;', '*5D7C71817B3F27;', '*5DA8BBE71A5F03;'],
        4: ['*200006A2DE8B1C;', '*20001420250AF0;', '*2000031BC5B39E;', '*2000031EEEDFAE;', '*20000E36A91BE9;', '*200006A2DEE500;', '*210000992F8C48;', '*200007A2D0869C;', '*20000E3956BBA1;', '*2020011CB7CEF5;'],
        18: ['*907CF7C610408498C81820006790;', '*907CF7C7C1000000001F04BF815D;', '*907CF7C710408498C82820A021BB;', '*907CF7C6C10400000020046EFBAC;', '*907CF7C6C104000000210460F62C;', '*907CF7C7C1000000001E04B18CDD;', '*907CF7C6C1040000001F04EA2B25;', '*907CF7C630408C98D8ADE0A061BB;', '*907CF7C7C5000000001E0C3FFF7F;'],
        20: ['*A0001420000000000007EE5154A7;', '*A0280319FA08BD09A020008DE244;', '*A00003340009A1157E2000FE035A;', '*A000011D0015370D40000088924F;', '*A0001020000000000007ED320583;', '*A0280319F9E8AB08E00800418E05;', '*A000031F0009A3157E580084DDB1;', '*A020011D0015210D00000033F676;', '*A10000968509090CA0A7F903110E;', '*A000031EF2999B14E22443D87C4F;'],
        16: ['*8061942058A20AA10C3A1E6EE7CD;', '*80818334581B428E8A31CF7C7D60;', '*8061902258822EFC8B9486FDA3BF;', '*808183195819A2903631F52A7D7A;', '*8061942258A22EFCE193EC57EC86;', '*8081831458194291C231CD654207;', '*808182BF5817F292F2315EDFCA2E;', '*80618522582A2EFD9D92ADA8531A;', '*808182B958179293B630CA1A8F00;', '*8061852A582AAAA332365DD50360;'],
        28: ['*E1999863859533;']
    };
    var lastRandomNumber = -1;
    function setExamplePacket(df) {
        var length = examplePackets[df].length;
        var id = parseInt(Math.random() * length, 10);
        if (length > 1) {
            while (lastRandomNumber == id) {
                id = parseInt(Math.random() * length, 10);
            }
            lastRandomNumber = id;
        } else {
            id = 0;
        }
        var packet = examplePackets[df][id];
        var packetField = $('#packet');
        packetField.val(packet);
        packetField.submit();
    }

    var examples = $('#examples');
    for (let key in examplePackets) {
        if (examplePackets.hasOwnProperty(key)) {
            var link = $('<a class="button">DF' + key + '</a>');
            link.val("DF " + key);
            link.click(function (event) {
                setExamplePacket(key);
                event.preventDefault()
            });
            examples.append(link);
            examples.append('&nbsp;');

        }
    }

</script>
</body>
</html>